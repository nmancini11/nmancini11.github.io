var dispatch=d3.dispatch("load","statechange");d3.csv("/data/runandgun.csv",function(t,e){if(t)throw t;var a=d3.map();e.forEach(function(t){a.set(t.skater,t)}),dispatch.call("load",this,a),dispatch.call("statechange",this,a.get("Nyjah Huston")),console.log(e)}),dispatch.on("load.menu",function(t){var e=d3.select("#mainbarchart").append("div").append("select").on("change",function(){dispatch.call("statechange",this,t.get(this.value))});e.selectAll("option").data(t.values()).enter().append("option").attr("value",function(t){return t.skater}).text(function(t){return t.skater}),dispatch.on("statechange.menu",function(t){e.property("value",t.skater)})}),dispatch.on("load.dismounts",function(){var t=d3.select("#dismount").append("text");dispatch.on("statechange.dismounts",function(e){t.text(e.dismounts)})}),dispatch.on("load.bar",function(t){var e={top:20,right:20,bottom:30,left:40},a=document.getElementById("mainbarchart").offsetWidth-e.left-e.right,n=460-e.top-e.bottom,s=d3.max(t.values(),function(t){return t.tricks.split(" || ").length}),r=d3.scaleLinear().domain([0,s]).rangeRound([0,a]).nice(),d=d3.axisBottom(r),i=d3.select("#mainbarchart").append("svg").attr("width",a+e.left+e.right).attr("height",n+e.top+e.bottom).append("g").attr("transform","translate("+e.left+","+e.top+")");i.append("g").attr("class","y axis").call(d);var o=i.append("rect").attr("x",0).attr("width",a).attr("y",-5).attr("height",5).style("fill","#aaa");dispatch.on("statechange.bar",function(t){o.transition().attr("x",0).attr("width",r(t.tricks.split(" || ").length)-r(0))})}),dispatch.on("load.pie",function(){function t(t){return function(e){var a=d3.interpolate(e.endAngle,t);return function(t){return e.endAngle=a(t),d(e)}}}var e=2*Math.PI,a=d3.select("#sidechart").append("svg"),n=document.getElementById("sidechart").offsetWidth,s=document.getElementById("sidechart").offsetHeight,r=a.append("g").attr("transform","translate("+n/1.9+","+s/2+")"),d=d3.arc().innerRadius(n/3.1).outerRadius(n/3.1+10).startAngle(0);a.append("text").attr("class","line-label").attr("y",s/1.78).attr("x",n/2.53).style("stroke","green","text-align","center").text("seconds"),r.append("path").datum({endAngle:e}).style("fill","#ddd").attr("d",d);var i=r.append("path").style("fill","#44bf70").datum({endAngle:0}).attr("d",d);dispatch.on("statechange.pie",function(r){var d=d3.sum(r.timeBetweenTricks.split(",")),o=t(d/(1.5*e));d3.selectAll(".second").remove(),a.append("text").attr("class","line-label second").attr("y",s/2).attr("x",n/2.3).style("font-size","36px").text(Math.round(d)),i.transition().duration(1500).ease(d3.easeExpInOut).attrTween("d",o),console.log(r.skater+" run duration: "+d),console.log("degrees: "+t((d+1.5)/e))})});