var dispatch=d3.dispatch("load","statechange"),selectedSkater="Paul Rodgriguez";d3.csv("/data/runandgun.csv",function(t,e){"use strict";if(t)throw t;var a=d3.map();e.forEach(function(t){a.set(t.skater,t)}),dispatch.call("load",this,a),dispatch.call("statechange",this,a.get("Paul Rodriguez"))}),dispatch.on("load.menu",function(t){"use strict";var e=d3.select("#mainbarchart").append("div").attr("class","select-style").append("select").on("change",function(){dispatch.call("statechange",this,t.get(this.value))});e.selectAll("option").data(t.values()).enter().append("option").attr("value",function(t){return t.skater}).text(function(t){return t.skater}),dispatch.on("statechange.menu",function(t){e.property("value",t.skater),selectedSkater=t.skater})}),dispatch.on("load.dismounts",function(){"use strict";var t=d3.select("#dismount").append("text");dispatch.on("statechange.dismounts",function(e){t.text(e.dismounts)})}),dispatch.on("load.bar",function(t){"use strict";var e={top:0,right:40,bottom:30,left:130},a=document.getElementById("mainbarchart").offsetWidth-e.left-e.right,n=375-e.top-e.bottom,r=d3.max(t.values(),function(t){return t.tricks.split(" || ").length}),s=d3.scaleLinear().domain([0,r]).rangeRound([0,a]).nice(),i=d3.axisBottom(s),l=d3.select("#mainbarchart").append("svg").attr("width",a+e.left+e.right).attr("height",n+e.top+e.bottom).append("g").attr("transform","translate("+e.left+","+e.top+")");l.append("g").attr("class","x axis").attr("transform","translate(0,355)").call(i);var o=0;for(var c in t)if(t.hasOwnProperty(c)){o++;var d=t[c];l.append("rect").attr("y",30*o).attr("height",5).attr("class",d.skater.replace(/ +/g,"")).transition().duration(1e3).delay(150).attr("width",s(d.tricks.split(" || ").length)).style("fill","#aaa"),l.append("text").attr("class","skater").attr("class",d.skater.replace(/ +/g,"")).attr("y",30*o+7).attr("x",-e.left).style("stroke","green","text-align","center").text(d.skater)}dispatch.on("statechange.bar",function(t){l.selectAll("rect").style("fill","#aaa"),l.selectAll("text").style("fill","#333").transition().duration(750).style("font-weight","normal"),l.select("rect."+t.skater.replace(/ +/g,"")).transition().duration(750).attr("width",s(t.tricks.split(" || ").length)).style("fill","#44bf70"),l.select("text."+t.skater.replace(/ +/g,"")).style("fill","#44bf70").transition().duration(750).style("font-weight","bold")})}),dispatch.on("load.trickstance",function(t){"use strict";var e={top:0,right:20,bottom:30,left:75},a=document.getElementById("trickstance").offsetWidth-e.left-e.right,n=170-e.top-e.bottom,r=d3.max(t.values(),function(t){for(var e=t.tricks.split(" || "),a=[],n=0,r=0,s=0,i=0,l=0;l<e.length;l++){var o=e[l].split(" ");"Switch"===o[0]?r++:"Nollie"===o[0]?s++:"Fakie"===o[0]?n++:i++}return a.push(i,n,s,r),d3.max(a)}),s=d3.scaleLinear().domain([0,r]).rangeRound([0,a]).nice(),i=d3.axisBottom(s),l=d3.select("#trickstance").append("svg").attr("width",a+e.left+e.right).attr("height",n+e.top+e.bottom).append("g").attr("transform","translate("+e.left+",-7)");l.append("g").attr("class","x axis").attr("transform","translate(0,145)").call(i),dispatch.on("statechange.trickstance",function(t){l.selectAll("rect").remove();for(var a=t.tricks.split(" || "),n={regular:0,fakie:0,nollie:0,switch:0},i=0;i<a.length;i++){var o=a[i].split(" ");"Switch"===o[0]?n.switch++:"Nollie"===o[0]?n.nollie++:"Fakie"===o[0]?n.fakie++:n.regular++}var c=Object.keys(n).map(function(t){return n[t]});r=Math.max.apply(null,c);var d=0;for(var p in n)if(n.hasOwnProperty(p)){d++;var h=n[p];l.append("rect").attr("y",30*d).style("fill","#aaa").attr("height",5).transition().ease(d3.easeCubic).duration(1e3).delay(150).attr("width",s(h)),l.append("text").attr("y",30*d+7).attr("x",-e.left).style("text-transform","capitalize").style("font-weight","normal").style("font-size","16px").style("line-height","24px").text(p)}})}),dispatch.on("load.rundown",function(){"use strict";var t={top:70,right:10,bottom:70,left:10},e=document.getElementById("rundown").offsetWidth-t.left-t.right,a=70-t.top-t.bottom,n=71,r=d3.scaleLinear().domain([0,n]).rangeRound([0,e]).nice(),s=d3.axisBottom(r).ticks(0),i=d3.select(".rundown").append("svg").attr("width",e+t.left+t.right).attr("height",a+t.top+t.bottom).append("g").attr("transform","translate("+t.left+",10)");dispatch.on("statechange.rundown",function(t){i.selectAll("circle").remove(),i.selectAll("text").remove();var a=t.timeBetweenTricks.split(","),l=1.5,o=t.tricks.split(" || ");n=d3.sum(t.timeBetweenTricks.split(",")),console.log(n),r=d3.scaleLinear().domain([0,n]).rangeRound([0,e]).nice(),s=d3.axisBottom(r).ticks(0),i.append("g").attr("class","x axis").attr("transform","translate(0,20)").style("fill","#44bf70").call(s);for(var c=0;c<a.length;c++){l+=parseInt(a[c]);var d=20;d=1===Math.abs(c%2)?50:5,i.append("circle").style("stroke","#ddd").style("fill","#ffffff").transition().duration(750).delay(150).attr("cx",r(l)).attr("cy","23").attr("r","8"),i.append("text").append("tspan").attr("x",r(l)-15).attr("y",d).style("opacity","0").transition().duration(750).delay(150).style("opacity","1").text(o[c]).attr("class","rundownTrick")}})}),dispatch.on("load.pie",function(){"use strict";function t(t){return function(e){var a=d3.interpolate(e.endAngle,t);return function(t){return e.endAngle=a(t),i(e)}}}var e=2*Math.PI,a=d3.select("#sidechart").append("svg"),n=document.getElementById("sidechart").offsetWidth,r=document.getElementById("sidechart").offsetHeight,s=a.append("g").attr("transform","translate("+n/1.9+","+r/2+")"),i=d3.arc().innerRadius(n/3.1).outerRadius(n/3.1+10).startAngle(0);a.append("text").attr("class","line-label").attr("y",r/1.68).attr("x",n/2.43).style("stroke","green","text-align","center").text("seconds"),s.append("path").datum({endAngle:e}).style("fill","#ddd").attr("d",i);var l=s.append("path").style("fill","#44bf70").datum({endAngle:0}).attr("d",i);dispatch.on("statechange.pie",function(s){var i=d3.sum(s.timeBetweenTricks.split(",")),o=t(i/(1.5*e));d3.selectAll(".second").remove(),a.append("text").attr("class","line-label second").attr("y",r/1.9).attr("x",n/2.25).style("font-size","36px").text(Math.round(i)),l.transition().duration(1500).ease(d3.easeExpInOut).attrTween("d",o)})});